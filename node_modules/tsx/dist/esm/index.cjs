"use strict";var O=Object.defineProperty;var u=(e,t)=>O(e,"name",{value:t,configurable:!0});var S=require("node:worker_threads"),f=require("../node-features-roYmp9jK.cjs"),j=require("../register-CFHoWWMX.cjs"),c=require("../module-resolve-filename-ClW3zsMQ.cjs"),w=require("node:url"),N=require("node:fs/promises"),P=require("../index-C1vsvhPH.cjs"),q=require("../source-map-BkNfvVZg.cjs"),T=require("../client-BTjWp1CE.cjs"),k=require("node:path"),F=require("node:fs");require("node:module"),require("get-tsconfig"),require("esbuild"),require("node:crypto"),require("node:os"),require("../temporary-directory-B83uKxJF.cjs"),require("node:net"),require("../get-pipe-path-DSB4_OG7.cjs");const d={active:!0},M=u(async e=>{if(!e)throw new Error(`tsx must be loaded with --import instead of --loader
The --loader flag was deprecated in Node v20.6.0 and v18.19.0`);d.namespace=e.namespace,e.tsconfig!==!1&&c.loadTsconfig(e.tsconfig??process.env.TSX_TSCONFIG_PATH),e.port&&(d.port=e.port,e.port.on("message",t=>{t==="deactivate"&&(d.active=!1,e.port.postMessage({type:"deactivated"}))}))},"initialize"),L=u(()=>(c.loadTsconfig(process.env.TSX_TSCONFIG_PATH),"process.setSourceMapsEnabled(true);"),"globalPreload"),g=new Map,D=u(async e=>{if(g.has(e))return g.get(e);if(!await F.promises.access(e).then(()=>!0,()=>!1)){g.set(e,void 0);return}const a=await F.promises.readFile(e,"utf8");try{const s=JSON.parse(a);return g.set(e,s),s}catch{throw new Error(`Error parsing: ${e}`)}},"readPackageJson"),J=u(async e=>{let t=new URL("package.json",e);for(;!t.pathname.endsWith("/node_modules/package.json");){const a=w.fileURLToPath(t),s=await D(a);if(s)return s;const o=t;if(t=new URL("../package.json",t),t.pathname===o.pathname)break}},"findPackageJson"),$=u(async e=>(await J(e))?.type??"commonjs","getPackageType"),A=u(e=>{const t=e.indexOf("?");e=t===-1?e:e.slice(0,t);const a=k.extname(e);if(a===".json")return"json";if(a===".mjs"||a===".mts")return"module";if(a===".cjs"||a===".cts")return"commonjs"},"getFormatFromExtension"),I=u(e=>{const t=A(e);if(t)return t;if(c.tsExtensionsPattern.test(e))return $(e)},"getFormatFromFileUrl"),h="tsx-namespace=",l=u(e=>{const t=e.indexOf(h);if(t===-1)return;const a=e[t-1];if(a!=="?"&&a!=="&")return;const s=t+h.length,o=e.indexOf("&",s);return o===-1?e.slice(s):e.slice(s,o)},"getNamespace"),E=f.isFeatureSupported(f.importAttributes)?"importAttributes":"importAssertions",b=u(async(e,t,a)=>{if(!d.active||d.namespace&&d.namespace!==l(e))return a(e,t);if(d.port){const r=new URL(e);r.searchParams.delete("tsx-namespace"),d.port.postMessage({type:"load",url:r.toString()})}T.parent.send&&T.parent.send({type:"dependency",path:e}),c.isJsonPattern.test(e)&&(t[E]||(t[E]={}),t[E].type="json");const s=await a(e,t),o=e.startsWith("file://")?w.fileURLToPath(e):e;if(s.format==="commonjs"&&f.isFeatureSupported(f.esmLoadReadFile)&&s.responseURL?.startsWith("file:")){const r=await N.readFile(new URL(e),"utf8"),[,n]=P.parseEsm(r);if(n.length>0){const i=`module.exports={${n.map(y=>y.n).filter(y=>y!=="default").join(",")}}`,m=new URLSearchParams({filePath:o});s.responseURL=`data:text/javascript,${encodeURIComponent(i)}?${m.toString()}`}return s}if(!s.source)return s;const p=s.source.toString();if(s.format==="json"||c.tsExtensionsPattern.test(e)){const r=await P.transform(p,o,{tsconfigRaw:c.fileMatcher?.(o)});return{format:"module",source:q.inlineSourceMap(r)}}if(s.format==="module"){const r=P.transformDynamicImport(o,p);r&&(s.source=q.inlineSourceMap(r))}return s},"load"),_=u(async e=>(!e.format&&e.url.startsWith(c.fileUrlPrefix)&&(e.format=await I(e.url)),e),"resolveMissingFormat"),x=[".js",".json",".ts",".tsx",".jsx"],R=u(async(e,t,a)=>{const[s,o]=e.split("?");let p;for(const r of x)try{return await _(await a(s+r+(o?`?${o}`:""),t))}catch(n){if(p===void 0&&n instanceof Error){const{message:i}=n;n.message=n.message.replace(`${r}'`,"'"),n.stack=n.stack.replace(i,n.message),p=n}}throw p},"tryExtensions"),U=u(async(e,t,a)=>{const s=c.isDirectoryPattern.test(e),o=s?"index":"/index",[p,r]=e.split("?");try{return await R(p+o+(r?`?${r}`:""),t,a)}catch(n){if(!s)try{return await R(e,t,a)}catch{}const i=n,{message:m}=i;throw i.message=i.message.replace(`${o.replace("/",k.sep)}'`,"'"),i.stack=i.stack.replace(m,i.message),i}},"tryDirectory"),v=u(async(e,t,a,s)=>{if(!d.active)return a(e,t);const o=t.parentURL&&l(t.parentURL),p=c.requestAcceptsQuery(e);if(p){let r=l(e);if(o&&!r&&(r=o,e+=`${e.includes("?")?"&":"?"}${h}${o}`),d.namespace&&d.namespace!==r)return a(e,t);if(c.isDirectoryPattern.test(e))return await U(e,t,a)}else if(c.tsconfigPathsMatcher&&!t.parentURL?.includes("/node_modules/")){const r=c.tsconfigPathsMatcher(e);for(const n of r)try{return await v(w.pathToFileURL(n).toString(),t,a)}catch{}}if(p&&(c.tsExtensionsPattern.test(t.parentURL)||c.allowJs)){const r=c.resolveTsPath(e);if(r)for(const n of r)try{return await _(await a(n,t))}catch(i){const{code:m}=i;if(m!=="ERR_MODULE_NOT_FOUND"&&m!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw i}}try{const r=await _(await a(e,t));if(c.requestAcceptsQuery(r.url)){const n=l(r.url);o&&!n&&(r.url+=`${r.url.includes("?")?"&":"?"}${h}${o}`)}return r}catch(r){if(r instanceof Error&&!s){const{code:n}=r;if(n==="ERR_UNSUPPORTED_DIR_IMPORT")try{return await U(e,t,a)}catch(i){if(i.code!=="ERR_PACKAGE_IMPORT_NOT_DEFINED")throw i}if(n==="ERR_MODULE_NOT_FOUND")try{return await R(e,t,a)}catch{}}throw r}},"resolve");f.isFeatureSupported(f.moduleRegister)&&S.isMainThread&&j.register(),exports.globalPreload=L,exports.initialize=M,exports.load=b,exports.resolve=v;
